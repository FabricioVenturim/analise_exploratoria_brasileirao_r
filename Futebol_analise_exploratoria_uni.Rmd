---
title: "Parte 1 - ggplot2"
author: "Fabrício Dalvi Venturim e Luis Felipe Marques"
date: "12/06/2022"
output:
  html_document:
    number_sections: yes
    highlight: tango
    theme: cerulean
    toc: yes
    toc_float:
      collapsed: yes
      smmoth_scroll: no
  pdf_document:
    toc: yes
---
Bibliotecas para o markdown:

```{r message=FALSE, warning=FALSE}
library("knitr")
library("kableExtra")
library("htmltools")
```

```{r message=FALSE, warning=FALSE}
if(!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)

if(!require(dplyr)) install.packages("dplyr")
library(dplyr)

if(!require(ggthemes)) install.packages("ggthemes")
library(ggthemes)
```
O banco de dados utilizados na parte 1 do trabalho foi:

https://github.com/adaoduque/Brasileirao_Dataset

```{r message=FALSE, warning=FALSE}
dados = read.csv("campeonato-brasileiro-full.csv")
```

# Curiosidade e propósito

Assim como no Case Sudy do Capítulo 3 do livro do Andy Kirk, sempre fomos fanáticos por futebol e toda a estatística que busca explicar esse esporte. Nos dias de hoje, o que mais se ouve nas televisões, sites e vídeos são estatísticas e informações sobre o mundo do futebol e suas peculiaridades.

Por conta disso, resolvemos pegar um banco de dados sobre o campeonato brasileiro, a fim de realizar algumas análises e tirar conclusões. 

## Estudar as variáveis do banco de dados

Uma boa forma de iniciar uma análise exploratória de dados é entender e classificar os tipos de variáveis do banco de dados.

Vamos ver o banco de dados:

```{r message=FALSE, warning=FALSE}
str(dados)
```

```{r message=FALSE, warning=FALSE}
head(dados)
```

```{r message=FALSE, warning=FALSE}
tail(dados)
```

Temos que a classificação das variáveis é a seguinte:

* Qualitativas:
  + `dia`, `mandante`, `visitante`, `vencedor`, `formacao_mandante`, `formacao_visitante`, `tecnico_mandante`, `tecnico_visitante`, `arena`, `hora`, `mandante_estado`, `visitante_estado`, `estado_vencedor`.

* Quantitativas:
  + `rodada`, `temporada`, `data`, `mandante_placar`, `visitante_placar`.

Agora que classificamos as variáveis, vamos fazer algumas **análises univariada**.

## Análise univariada

Como eu peguei esta base da internet, certas variáveis(colunas) não me interessam muito a princípio. Portanto, vou trabalhar com as mais importante, e, caso necessário, utilizo as demais.

### Variável Qualitativa

Com as variáveis `vencedor`, `arena`, `estado_vencedor`, `formacao_mandante`, `formacao_visitante`, `hora` e `dia` podemos obter uma tabela de frequência, um gráfico de barras ou setores e, por fim, a moda:

#### `vencedor`:

frequência: 

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(vencedor) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$vencedor[idx]
tabela$vencedor <- factor(tabela$vencedor, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(tabela, aes(x = vencedor, y = N))
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Times", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1))
```

Percebe-se que não ficou muito legal de visualizar por conta da quantidade de times. Então, vamos ver apenas os times com mais vitórias.

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$vencedor[idx]
tabela$vencedor <- factor(tabela$vencedor, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(head(tabela), aes(x = vencedor, y = N))
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Times", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1)) +
  geom_text(aes(label = N), vjust = -1) +
  ylim(0,2200)

```

**Percebe-se que, desconsiderando a quantidade de empates (-), os times que mais venceram foram o São Paulo(338), Flamengo(317), Santos(317), Internacional(304) e Corinthians(296).**

**Além disso, de 2003 até 2021, houveram 2015 empates, o que, considerando que tiveram 7645 jogos, representa  26,35% dos resultados dos jogos.**

#### `arena`:

Vamos repeti o mesmo código, mas agora analisando a `arena`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(arena) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$arena[idx]
tabela$arena <- factor(tabela$arena, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(tabela, aes(x = arena, y = N))
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Arenas", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1))
```

Novamento, vamos pegar os primeiros:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$arena[idx]
tabela$arena <- factor(tabela$arena, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(head(tabela), aes(x = arena, y = N))
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Arenas", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1)) +
  geom_text(aes(label = N), vjust = -1) + 
  ylim(0, 750)
```

**Ao tentar colocar todos as arenas que houve jogos, percebe-se que fica praticamente impossível de visualizar, visto que há uma quantidade gigantesca de estádios no Brasil.**

**Quando olhamos paraas arenas que tiveram mais jogos, percebemos que os que houvera mais jogos foram o Maracanã (Flamengo e Fluminense), Minerão (Cruzeiro e Atlético Mg), Morumbi(São Paulo), Couto Pereira (Coritiba) e Serra Dourada(Goiás).**

#### `estado_vencedor`:

Vamos repeti o mesmo código, mas agora analisando a `estado_vencedor`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(estado_vencedor) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$estado_vencedor[idx]
tabela$estado_vencedor <- factor(tabela$estado_vencedor, levels=levels, ordered=TRUE)

estados <- c("SP", "RJ", "RS", "MG", "PR","SC","GO","BA","PE","CE","PA","DF","MT","AL","RN")

# Gráfico
p <- tabela %>% filter(tabela$estado_vencedor%in%estados) %>%  ggplot(aes(x = estado_vencedor, y = N))

p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Estado", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1))
```

**Percebe-se que, desconsiderando a quantidade de empates (-), os estados que tiveram mais times vencedores foram São Paulo, Rio de Janiero, Rio Grande do Sul, Minas Gerais e Paraná.**

**Algo interessante é que, considerando os times que mais venceram: São Paulo, Flamengo, Santos, Internacional e Corinthians, temos que eles pertence aos 3 estados que mais ganharam, sendo São Paulo, Santos e Corinthians de SP.**

#### `formacao_mandante`:

Vamos repeti o mesmo código, mas agora analisando a `formacao_mandante`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(formacao_mandante) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$formacao_mandante[idx]
tabela$formacao_mandante <- factor(tabela$formacao_mandante, levels=levels, ordered=TRUE)

formacoes <- c("4-2-3-1","4-1-4-1","4-3-3","4-4-2","4-2-2-2","4-3-2-1","4-3-1-2","4-4-1-1","3-4-1-2","3-4-1-2","4-1-2-1-2","3-4-3","5-4-1","4-5-1","4-1-3-2","3-5-2","5-3-2","4-2-4-0", "3-1-4-2", "3-2-4-1", "3-5-1-1")

# Gráfico
p <- tabela %>% filter(tabela$formacao_mandante%in%formacoes) %>% ggplot(aes(x = formacao_mandante, y = N), na.rm = FALSE)

p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Formação", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1))
```

**Portanto, a formação 4-2-3-1 é praticamente predominante nos times mandantes do campeonato brasileiro, sendo 4-1-4-1, 4-3-3 e 4-4-2 as outras mais utilizadas. **

**Algo legal de ver é se esses números mudam quando analisamos os times visitantes:**

#### `formacao_visitante`:

Vamos repeti o mesmo código, mas agora analisando a `formacao_visitante`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(formacao_visitante) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$formacao_visitante[idx]
tabela$formacao_visitante <- factor(tabela$formacao_visitante, levels=levels, ordered=TRUE)

# Gráfico
formacoes <- c("4-2-3-1","4-1-4-1","4-3-3","4-4-2","4-2-2-2","4-3-2-1","4-3-1-2","4-4-1-1","3-4-1-2","3-4-1-2","4-1-2-1-2","3-4-3","5-4-1","4-5-1","4-1-3-2","3-5-2","5-3-2","4-2-4-0", "3-1-4-2", "3-2-4-1", "3-5-1-1")

p <- tabela %>% filter(tabela$formacao_visitante%in%formacoes) %>% ggplot(aes(x = formacao_visitante, y = N), na.rm = FALSE)

p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Formação", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1))
```

**Portanto, a formação 4-2-3-1 é praticamente predominante nos times mandantes do campeonato brasileiro, sendo 4-1-4-1, 4-3-3 e 4-4-2 as outras mais utilizadas. **

**Percebe-se que a formação mais utilizada pelos times visitantes é novamente a 4-2-3-1. é muito interessante como, independentemente se o jogo é em casa ou fora, os times mantem a mesma formação. **

#### `dia`:

Vamos repeti o mesmo código, mas agora analisando a `dia`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(dia) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$dia[idx]
tabela$dia <- factor(tabela$dia, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(data = subset(tabela, !is.na(dia)), aes(x = dia, y = N), na.rm = FALSE)
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Dia", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1)) +
  geom_text(aes(label = N), vjust = -1) +
  ylim(0, 4000)
```

**Aqui aparece algo muito interessante: a maior parte dos jogos do brasileirão ocorrem no fim de semana. Isso é explicado pois o brasileirão não ocorre em alguns meios de semanas por conta dos campeonatos em formato de copa ocorrerem no meio de semana.** 

#### `hora`:

Vamos repeti o mesmo código, mas agora analisando a `formacao_visitante`:

```{r message=FALSE, warning=FALSE}
tabela <- dados %>% 
  group_by(hora) %>% 
  summarize(N = n()) %>% 
  mutate(freq = N / sum(N), pct = round((freq*100),0))
tabela <- tabela[order(tabela$N,decreasing=TRUE),]
```

Vamos plotar um gráfico para ter essas informaçoes visualmente:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$hora[idx]
tabela$hora <- factor(tabela$hora, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(data = subset(tabela, !is.na(hora)), aes(x = hora, y = N), na.rm = FALSE)
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Horário", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1)) +
  geom_text(aes(label = N), vjust = -1) +
  ylim(0, 2200)
```

Novamente, vamos pegar os primeiros:

```{r message=FALSE, warning=FALSE}
# Ordenar da maior quantidade de vitórias para a menor
idx <- order(tabela$N, decreasing = TRUE)
levels <- tabela$hora[idx]
tabela$hora <- factor(tabela$hora, levels=levels, ordered=TRUE)

# Gráfico
p <- ggplot(head(tabela), aes(x = hora, y = N, na.rm = TRUE))
p + geom_col(position = "dodge2", fill = 'blue') +
  labs(x = "Horário", y = "Quantidade") +
  theme(legend.position = "top", 
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust = 1)) +
  geom_text(aes(label = N), vjust = -1) + 
  ylim(0, 2200)
```

**É notório que o horário que mais há jogos é o de 16:00. Como visto anteriomente, os dia da semana com mais jogos é o domingo, que é justamente o dia que há jogos às 16:00 e às 18:30. No meio de semana, os jogos costumam ocorrer 20:30 e 21:00.**

### Variável Quantitativa

As únicas variáveis quantitativas que são interessantes de fazer uma análise são `mandante_placar`, `visitante_placar`. No futuro, elas serão imprescindíveis para as análises bidimensionais. 

#### `mandante_placar`

Primeiramente, vamos olhar a frequência da quantidade de gols por partida dos times mandantes: 

```{r message=FALSE, warning=FALSE}
mandante_placar_frequencia <- table(dados$mandante_placar)
mandante_placar_frequencia
```

Com esses valores, podemos gerar um histograma para melhor visualizar:

```{r message=FALSE, warning=FALSE}
ggplot(data = dados, aes(x = mandante_placar)) +
  geom_histogram(fill = 'blue', bins = 8)
```

**É possível observar que a quantidade de gols se concentra claramente entre 0 a 3 gols por partida, sendo 1 gol o mais comum de ocorrer.**

Agora, vamos observar as estatísticas descritivas e, após gerar também as estatísticas do `mandante_visitante`, compará-las:

```{r message=FALSE, warning=FALSE}
#Média
mean(dados$mandante_placar)

#Mediana
median(dados$mandante_placar)

#Quartis
quantile(dados$mandante_placar)
```

Passando agora para medidas de dispersão, vejamos como obter máximo e mínimo, e com isso a amplitude, além da variância, desvio padrão, e coeficiente de variação. Também obtemos os quartis para calcular a amplitude interquartílica.

```{r message=FALSE, warning=FALSE}
#Max
max(dados$mandante_placar)

#Min 
min(dados$mandante_placar)

#Amplitude 
diff(range(dados$mandante_placar))

# Variância
var(dados$mandante_placar)

# Desvio-padrão
sd(dados$mandante_placar)
```

No r há a função `summary()` que resume todo esses dados:

```{r message=FALSE, warning=FALSE}
summary(dados$mandante_placar)
```

#### `visitante_placar`

Agora, vamos olhar a frequência da quantidade de gols por partida dos visitantes: 

```{r message=FALSE, warning=FALSE}
visitante_placar_frequencia <- table(dados$visitante_placar)
visitante_placar_frequencia
```

Com esses valores, podemos gerar um histograma para melhor visualizar:

```{r message=FALSE, warning=FALSE}
ggplot(data = dados, aes(x = visitante_placar)) +
  geom_histogram(fill = 'blue', bins = 8)
```

**Diferente dos times que jogam em casa, os times visitantes marcaram por volta de 0 a 3 gols por partida. O mais interessante é que a quantidade mais comum de ocorrer é 0 gols por partida, o que difere dos mandantes, que tinham 1 gol como mais comum.**

Agora, vamos observar as estatísticas descritivas

```{r message=FALSE, warning=FALSE}
#Média
mean(dados$visitante_placar)

#Mediana
median(dados$visitante_placar)

#Quartis
quantile(dados$visitante_placar)
```

Passando agora para medidas de dispersão, vejamos como obter máximo e mínimo, e com isso a amplitude, além da variância, desvio padrão, e coeficiente de variação. Também obtemos os quartis para calcular a amplitude interquartílica.

```{r message=FALSE, warning=FALSE}
#Max
max(dados$visitante_placar)

#Min 
min(dados$visitante_placar)

#Amplitude 
diff(range(dados$visitante_placar))

# Variância
var(dados$visitante_placar)

# Desvio-padrão
sd(dados$visitante_placar)
```

No r há a função `summary()` que resume todo esses dados:

```{r message=FALSE, warning=FALSE}
summary(dados$visitante_placar)
```

#### Análise quantitativa

**Percebe-se, portanto, que, ao comparar as médias do número de gols, os mandantes fazem 0,5 a mais de gols nas partidas, uma vez que média de gols dos mandantes é de 1.554088 e dos visitantes é de 1.027338. **

**Isso fornece algo interessante: jogar em casa, por conta da torcida, do ambiente e de não ter que fazer viagens - entre outros fatores - favorece os times, visto que há uma probabilidade maior de marcar gols.**

**É muito fácil perceber isso ao analisar os histogramas gerados, uma vez que, como comentado, a quantidade de gols mais comum de ocorrer para os visitantes é 0 gols por partida, o que difere dos mandantes, que possuem 1 gol como mais comum.**


